<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ManuEstudia</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
/* Responsive para m√≥viles (‚â§768px) */
@media (max-width: 768px) {
  body {
    padding: 1rem;
  }

  h1 {
    font-size: 2rem;
    text-align: center;
  }

  h2 {
    font-size: 1.4rem;
  }

  .tabs {
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
  }

  .tab-button {
    flex: 1 1 100%;
    font-size: 1rem;
    padding: 0.8rem 1rem;
  }

  .calculator,
  .pomodoro-container,
  .converter-container,
  .agenda-container,
  .pdf-summarizer {
    padding: 1.2rem;
  }

  .calculator-buttons {
    grid-template-columns: repeat(4, 1fr);
    gap: 0.6rem;
  }

  .calculator-btn {
    font-size: 1.1rem;
    padding: 0.9rem;
  }

  .pomodoro-btn {
    margin: 0.3rem;
    padding: 0.6rem 1rem;
    font-size: 0.9rem;
  }

  .timer-display {
    font-size: 3rem;
  }

  .converter-row {
    flex-direction: column;
    align-items: stretch;
  }

  .converter-row label {
    width: 100%;
  }

  .pdf-summary-controls {
    flex-direction: column;
    align-items: stretch;
  }

  #agendaForm {
    flex-direction: column;
    gap: 0.5rem;
  }

  #agendaForm button {
    width: 100%;
  }

  #taskList {
    max-height: 200px;
  }

  .pdf-upload-icon {
    font-size: 3rem;
  }

  .pdf-upload-text {
    font-size: 1rem;
  }

  .pdf-summary-result {
    font-size: 0.95rem;
  }
}

/* Ajustes para m√≥viles muy peque√±os (‚â§480px) */
@media (max-width: 480px) {
  h1 {
    font-size: 1.7rem;
  }

  .tab-button {
    font-size: 0.9rem;
    padding: 0.7rem;
  }

  .calculator-display {
    height: 60px;
    font-size: 1.6rem;
  }

  .timer-display {
    font-size: 2.5rem;
  }

  .converter-btn,
  .pomodoro-btn,
  .pdf-summary-controls button {
    font-size: 0.95rem;
    padding: 0.7rem 1rem;
  }
}

</head>
<body>
<div class="container">
  <h1>ManuEstudia - Todo en Uno</h1>

  <div class="tabs">
    <button class="tab-button active" data-tab="1">Calculadora B√°sica</button>
    <button class="tab-button" data-tab="2">Calculadora Cient√≠fica</button>
    <button class="tab-button" data-tab="3">Pomodoro</button>
    <button class="tab-button" data-tab="4">Conversor</button>
    <button class="tab-button" data-tab="5">Agenda</button>
    <button class="tab-button" data-tab="6">Resumidor PDF</button>
  </div>

  <!-- Calculadora B√°sica -->
  <div id="tab1" class="tab-content active">
    <div class="calculator">
      <input type="text" id="basicDisplay" class="calculator-display" readonly />
      <div class="calculator-buttons">
        <button class="calculator-btn" data-value="7">7</button>
        <button class="calculator-btn" data-value="8">8</button>
        <button class="calculator-btn" data-value="9">9</button>
        <button class="calculator-btn operator" data-value="/">√∑</button>

        <button class="calculator-btn" data-value="4">4</button>
        <button class="calculator-btn" data-value="5">5</button>
        <button class="calculator-btn" data-value="6">6</button>
        <button class="calculator-btn operator" data-value="*">√ó</button>

        <button class="calculator-btn" data-value="1">1</button>
        <button class="calculator-btn" data-value="2">2</button>
        <button class="calculator-btn" data-value="3">3</button>
        <button class="calculator-btn operator" data-value="-">‚àí</button>

        <button class="calculator-btn clear" data-action="clear">C</button>
        <button class="calculator-btn" data-value="0">0</button>
        <button class="calculator-btn equals" data-action="equals">=</button>
        <button class="calculator-btn operator" data-value="+">+</button>
      </div>
    </div>
  </div>

  <!-- Calculadora Cient√≠fica -->
  <div id="tab2" class="tab-content">
    <div class="calculator">
      <input type="text" id="sciDisplay" class="calculator-display" readonly />
      <div class="calculator-buttons">
        <button class="calculator-btn" data-value="7">7</button>
        <button class="calculator-btn" data-value="8">8</button>
        <button class="calculator-btn" data-value="9">9</button>
        <button class="calculator-btn operator" data-value="/">√∑</button>

        <button class="calculator-btn" data-value="4">4</button>
        <button class="calculator-btn" data-value="5">5</button>
        <button class="calculator-btn" data-value="6">6</button>
        <button class="calculator-btn operator" data-value="*">√ó</button>

        <button class="calculator-btn" data-value="1">1</button>
        <button class="calculator-btn" data-value="2">2</button>
        <button class="calculator-btn" data-value="3">3</button>
        <button class="calculator-btn operator" data-value="-">‚àí</button>

        <button class="calculator-btn clear" data-action="clear">C</button>
        <button class="calculator-btn" data-value="0">0</button>
        <button class="calculator-btn equals" data-action="equals">=</button>
        <button class="calculator-btn operator" data-value="+">+</button>

        <!-- Funciones cient√≠ficas -->
        <button class="calculator-btn function" data-func="sin">sin</button>
        <button class="calculator-btn function" data-func="cos">cos</button>
        <button class="calculator-btn function" data-func="tan">tan</button>
        <button class="calculator-btn function" data-func="log">log</button>

        <button class="calculator-btn function" data-func="sqrt">‚àö</button>
        <button class="calculator-btn function" data-func="pow2">x¬≤</button>
        <button class="calculator-btn function" data-func="pow3">x¬≥</button>
        <button class="calculator-btn function" data-func="pi">œÄ</button>

        <button class="calculator-btn function" data-func="exp">eÀ£</button>
        <button class="calculator-btn function" data-func="abs">abs</button>
        <button class="calculator-btn function" data-func="fact">n!</button>
        <button class="calculator-btn function" data-func="neg">+/-</button>
      </div>
    </div>
  </div>

  <!-- Pomodoro -->
  <div id="tab3" class="tab-content">
    <div class="pomodoro-container">
      <h2>Pomodoro Timer</h2>
      <div class="pomodoro-input">
        <label for="workDuration">Duraci√≥n trabajo (min):</label>
        <input type="number" id="workDuration" value="25" min="1" max="120" />
      </div>
      <div class="pomodoro-input">
        <label for="breakDuration">Duraci√≥n descanso (min):</label>
        <input type="number" id="breakDuration" value="5" min="1" max="60" />
      </div>
      <div class="timer-display" id="pomodoroTimer">25:00</div>
      <div class="pomodoro-status" id="pomodoroStatus">Estado: Listo</div>
      <div>
        <button class="pomodoro-btn start" id="pomodoroStartBtn">Iniciar</button>
        <button class="pomodoro-btn pause" id="pomodoroPauseBtn" disabled>Pausar</button>
        <button class="pomodoro-btn stop" id="pomodoroStopBtn" disabled>Detener</button>
      </div>
    </div>
  </div>

  <!-- Conversor -->
  <div id="tab4" class="tab-content">
    <div class="converter-container">
      <h2>Conversor</h2>
      <div class="converter-row">
        <label for="conversionType">Tipo:</label>
        <select id="conversionType">
          <option value="length">Longitud</option>
          <option value="weight">Peso</option>
          <option value="temperature">Temperatura</option>
        </select>
      </div>
      <div class="converter-row">
        <label for="inputValue">Valor:</label>
        <input type="number" id="inputValue" placeholder="Introduce valor" />
      </div>
      <div class="converter-row">
        <label for="fromUnit">De:</label>
        <select id="fromUnit"></select>
      </div>
      <div class="converter-row">
        <label for="toUnit">A:</label>
        <select id="toUnit"></select>
      </div>
      <button class="converter-btn" id="convertBtn">Convertir</button>
      <div class="converter-result" id="conversionResult"></div>
    </div>
  </div>

  <!-- Agenda -->
  <div id="tab5" class="tab-content">
    <div class="agenda-container">
      <h2>Agenda - Tareas (clic para eliminar)</h2>
      <form id="agendaForm">
        <input type="text" id="agendaTask" placeholder="Nueva tarea" required />
        <button type="submit">Agregar</button>
      </form>
      <ul id="taskList"></ul>
    </div>
  </div>

  <!-- Resumidor PDF -->
  <div id="tab6" class="tab-content">
    <div class="pdf-summarizer">
      <h2>Resumidor de PDF</h2>
      <div class="pdf-upload-area" id="pdfUploadArea" tabindex="0" role="button" aria-label="Subir archivo PDF">
        <input type="file" id="pdfFileInput" accept=".pdf" style="display:none" />
        <div class="pdf-upload-icon">üìÑ</div>
        <div class="pdf-upload-text">Haz clic o arrastra un archivo PDF aqu√≠</div>
        <div class="pdf-upload-hint">Solo archivos PDF. Tama√±o m√°ximo 5MB.</div>
      </div>
      <div class="pdf-summary-controls">
        <select id="summaryLength">
          <option value="short">Resumen corto</option>
          <option value="medium" selected>Resumen medio</option>
          <option value="long">Resumen largo</option>
        </select>
        <button id="summarizeBtn">Resumir</button>
      </div>
      <div class="pdf-summary-result" id="pdfSummaryResult">
        <h3>Resumen</h3>
        <p id="summaryText">Sube un archivo y pulsa resumir.</p>
      </div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
<script>

// ================= Tabs =================
const tabs = document.querySelectorAll('.tab-button');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const target = tab.dataset.tab;
    contents.forEach(c => c.classList.remove('active'));
    document.getElementById('tab' + target).classList.add('active');
  });
});

// ================= Calculadora B√°sica =================
const basicDisplay = document.getElementById('basicDisplay');
const basicButtons = document.querySelectorAll('#tab1 .calculator-btn');
basicButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const val = btn.dataset.value;
    const action = btn.dataset.action;
    if (action === 'clear') {
      basicDisplay.value = '';
    } else if (action === 'equals') {
      try {
        // Reemplaza √ó y √∑ con * y / para evaluaci√≥n
        const expr = basicDisplay.value.replace(/√∑/g, '/').replace(/√ó/g, '*');
        const result = eval(expr);
        basicDisplay.value = result;
      } catch {
        basicDisplay.value = 'Error';
      }
    } else {
      basicDisplay.value += val;
    }
  });
});

// ================= Calculadora Cient√≠fica =================
const sciDisplay = document.getElementById('sciDisplay');
const sciButtons = document.querySelectorAll('#tab2 .calculator-btn');
let sciExpression = '';
sciButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const val = btn.dataset.value;
    const func = btn.dataset.func;
    const action = btn.dataset.action;

    if (action === 'clear') {
      sciExpression = '';
      sciDisplay.value = '';
    } else if (action === 'equals') {
      try {
        // Evaluar expresiones matem√°ticas usando Math y funciones definidas
        const safeEval = (expr) => {
          // Funciones matem√°ticas permitidas
          const mathFuncs = {
            sin: Math.sin,
            cos: Math.cos,
            tan: Math.tan,
            log: Math.log10,
            sqrt: Math.sqrt,
            pow: Math.pow,
            abs: Math.abs,
            exp: Math.exp,
            pi: Math.PI,
            e: Math.E,
            fact: (n) => {
              if (n < 0) return NaN;
              if (n === 0) return 1;
              let f = 1;
              for (let i = 1; i <= n; i++) f *= i;
              return f;
            }
          };
          // Reemplaza œÄ con Math.PI y e con Math.E
          expr = expr.replace(/œÄ/g, 'Math.PI').replace(/e/g, 'Math.E');

          // Reemplaza factorial
          expr = expr.replace(/(\d+)!/g, 'fact($1)');

          // Reemplaza potencias al cuadrado y cubo
          expr = expr.replace(/(\d+)\^2/g, 'Math.pow($1,2)');
          expr = expr.replace(/(\d+)\^3/g, 'Math.pow($1,3)');

          // Eval√∫a la expresi√≥n de manera segura
          return Function('fact', 'Math', 'return ' + expr)(mathFuncs.fact, Math);
        };

        const result = safeEval(sciExpression);
        sciDisplay.value = result;
        sciExpression = result.toString();
      } catch {
        sciDisplay.value = 'Error';
        sciExpression = '';
      }
    } else if (func) {
      // Funciones cient√≠ficas
      if (func === 'pi') {
        sciExpression += 'œÄ';
        sciDisplay.value = sciExpression;
      } else if (func === 'pow2') {
        sciExpression += '^2';
        sciDisplay.value = sciExpression;
      } else if (func === 'pow3') {
        sciExpression += '^3';
        sciDisplay.value = sciExpression;
      } else if (func === 'fact') {
        sciExpression += '!';
        sciDisplay.value = sciExpression;
      } else if (func === 'neg') {
        // Negar √∫ltimo n√∫mero
        if (sciExpression.startsWith('-')) {
          sciExpression = sciExpression.substring(1);
        } else {
          sciExpression = '-' + sciExpression;
        }
        sciDisplay.value = sciExpression;
      } else {
        sciExpression += func + '(';
        sciDisplay.value = sciExpression;
      }
    } else {
      sciExpression += val;
      sciDisplay.value = sciExpression;
    }
  });
});

// ================= Pomodoro =================
const pomodoroTimer = document.getElementById('pomodoroTimer');
const pomodoroStatus = document.getElementById('pomodoroStatus');
const workInput = document.getElementById('workDuration');
const breakInput = document.getElementById('breakDuration');
const startBtn = document.getElementById('pomodoroStartBtn');
const pauseBtn = document.getElementById('pomodoroPauseBtn');
const stopBtn = document.getElementById('pomodoroStopBtn');

let pomodoroInterval = null;
let isRunning = false;
let isWorkTime = true;
let timeLeft = 0;

function updateTimerDisplay() {
  const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
  const seconds = (timeLeft % 60).toString().padStart(2, '0');
  pomodoroTimer.textContent = `${minutes}:${seconds}`;
}

function startPomodoro() {
  if (isRunning) return;
  isRunning = true;
  pauseBtn.disabled = false;
  stopBtn.disabled = false;
  workInput.disabled = true;
  breakInput.disabled = true;
  pomodoroStatus.textContent = isWorkTime ? 'Estado: Trabajando' : 'Estado: Descansando';
  timeLeft = isWorkTime ? workInput.value * 60 : breakInput.value * 60;
  updateTimerDisplay();

  pomodoroInterval = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    if (timeLeft <= 0) {
      isWorkTime = !isWorkTime;
      pomodoroStatus.textContent = isWorkTime ? 'Estado: Trabajando' : 'Estado: Descansando';
      timeLeft = isWorkTime ? workInput.value * 60 : breakInput.value * 60;
      updateTimerDisplay();
    }
  }, 1000);
}

function pausePomodoro() {
  if (!isRunning) return;
  isRunning = false;
  clearInterval(pomodoroInterval);
  pauseBtn.disabled = true;
  pomodoroStatus.textContent += ' (Pausado)';
}

function stopPomodoro() {
  isRunning = false;
  clearInterval(pomodoroInterval);
  pauseBtn.disabled = true;
  stopBtn.disabled = true;
  workInput.disabled = false;
  breakInput.disabled = false;
  isWorkTime = true;
  timeLeft = 0;
  pomodoroTimer.textContent = '25:00';
  pomodoroStatus.textContent = 'Estado: Listo';
}

startBtn.addEventListener('click', startPomodoro);
pauseBtn.addEventListener('click', pausePomodoro);
stopBtn.addEventListener('click', stopPomodoro);

// ================= Conversor =================
const conversionType = document.getElementById('conversionType');
const inputValue = document.getElementById('inputValue');
const fromUnit = document.getElementById('fromUnit');
const toUnit = document.getElementById('toUnit');
const convertBtn = document.getElementById('convertBtn');
const conversionResult = document.getElementById('conversionResult');

const units = {
  length: {
    m: 1,
    km: 1000,
    cm: 0.01,
    mm: 0.001,
    inch: 0.0254,
    ft: 0.3048,
    yd: 0.9144,
    mile: 1609.34,
  },
  weight: {
    g: 1,
    kg: 1000,
    mg: 0.001,
    lb: 453.592,
    oz: 28.3495,
  },
  temperature: {
    C: 'C',
    F: 'F',
    K: 'K',
  }
};

function populateUnits(type) {
  fromUnit.innerHTML = '';
  toUnit.innerHTML = '';
  if (type === 'temperature') {
    ['C', 'F', 'K'].forEach(u => {
      const optionFrom = document.createElement('option');
      optionFrom.value = u;
      optionFrom.textContent = u;
      fromUnit.appendChild(optionFrom);

      const optionTo = document.createElement('option');
      optionTo.value = u;
      optionTo.textContent = u;
      toUnit.appendChild(optionTo);
    });
  } else {
    Object.keys(units[type]).forEach(u => {
      const optionFrom = document.createElement('option');
      optionFrom.value = u;
      optionFrom.textContent = u;
      fromUnit.appendChild(optionFrom);

      const optionTo = document.createElement('option');
      optionTo.value = u;
      optionTo.textContent = u;
      toUnit.appendChild(optionTo);
    });
  }
}

function convertTemperature(value, from, to) {
  if (from === to) return value;
  let celsius;
  switch(from) {
    case 'C': celsius = value; break;
    case 'F': celsius = (value - 32) * 5/9; break;
    case 'K': celsius = value - 273.15; break;
  }
  switch(to) {
    case 'C': return celsius;
    case 'F': return celsius * 9/5 + 32;
    case 'K': return celsius + 273.15;
  }
}

function convertUnits() {
  const type = conversionType.value;
  const val = parseFloat(inputValue.value);
  const from = fromUnit.value;
  const to = toUnit.value;
  if (isNaN(val)) {
    conversionResult.textContent = 'Introduce un valor v√°lido.';
    return;
  }
  if (type === 'temperature') {
    const result = convertTemperature(val, from, to);
    conversionResult.textContent = `${val} ${from} = ${result.toFixed(2)} ${to}`;
  } else {
    const base = units[type][from];
    const target = units[type][to];
    const result = val * base / target;
    conversionResult.textContent = `${val} ${from} = ${result.toFixed(4)} ${to}`;
  }
}

conversionType.addEventListener('change', () => {
  populateUnits(conversionType.value);
  conversionResult.textContent = '';
  inputValue.value = '';
});
convertBtn.addEventListener('click', convertUnits);
populateUnits(conversionType.value);

// ================= Agenda =================
const agendaForm = document.getElementById('agendaForm');
const agendaTask = document.getElementById('agendaTask');
const taskList = document.getElementById('taskList');

function loadTasks() {
  const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  taskList.innerHTML = '';
  tasks.forEach(task => {
    const li = document.createElement('li');
    li.textContent = task;
    li.addEventListener('click', () => {
      deleteTask(task);
    });
    taskList.appendChild(li);
  });
}

function saveTask(task) {
  const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  tasks.push(task);
  localStorage.setItem('tasks', JSON.stringify(tasks));
  loadTasks();
}

function deleteTask(task) {
  let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  tasks = tasks.filter(t => t !== task);
  localStorage.setItem('tasks', JSON.stringify(tasks));
  loadTasks();
}

agendaForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const task = agendaTask.value.trim();
  if (task) {
    saveTask(task);
    agendaTask.value = '';
  }
});

loadTasks();

// ================= Resumidor PDF =================

function simpleSummarize(text, level = 'medium') {
  const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
  let count;
  switch (level) {
    case 'short': count = 2; break;
    case 'medium': count = 5; break;
    case 'long': count = 10; break;
    default: count = 5;
  }
  return sentences.slice(0, count).join(' ').trim();
}

async function extractTextFromPDF(file) {
  const arrayBuffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
  let fullText = '';
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    const strings = content.items.map(item => item.str);
    fullText += strings.join(' ') + ' ';
  }
  return fullText;
}

// Drag & drop functionality
const uploadArea = document.getElementById('pdfUploadArea');
const fileInput = document.getElementById('pdfFileInput');
const summarizeBtn = document.getElementById('summarizeBtn');
const summaryText = document.getElementById('summaryText');

uploadArea.addEventListener('click', () => fileInput.click());
uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.style.border = '2px dashed #666';
});
uploadArea.addEventListener('dragleave', () => {
  uploadArea.style.border = '';
});
uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.style.border = '';
  const file = e.dataTransfer.files[0];
  if (file && file.type === 'application/pdf') {
    fileInput.files = e.dataTransfer.files;
  } else {
    alert('Solo se permiten archivos PDF.');
  }
});

summarizeBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if (!file || file.type !== 'application/pdf') {
    summaryText.textContent = 'Por favor sube un archivo PDF v√°lido.';
    return;
  }

  summaryText.textContent = 'Procesando resumen...';

  try {
    const text = await extractTextFromPDF(file);
    const level = document.getElementById('summaryLength').value;
    const summary = simpleSummarize(text, level);
    summaryText.textContent = summary || 'No se pudo generar un resumen.';
  } catch (error) {
    summaryText.textContent = 'Error procesando el PDF: ' + error.message;
  }
});
</script>
</body>
</html>
